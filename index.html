<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Academic Literacy Chat</title>
    <style>
      :root { 
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji'; 
      }
      html, body { 
        margin: 0; 
        padding: 0; 
        height: 100%; 
        background: #000; 
        color: #fff; 
        overflow: hidden; 
      }
      .wrap { 
        height: 100%; 
        display: flex; 
        flex-direction: column; 
        padding: 24px; 
        box-sizing: border-box; 
      }
      h1 { 
        font-size: 1.5rem; 
        margin: 0 0 16px; 
        color: #fff; 
      }
      .chat-container {
        flex: 1;
        background: #000;
        border: 1px solid #333;
        border-radius: 12px;
        padding: 16px;
        overflow-y: auto;
        margin-bottom: 16px;
        box-sizing: border-box;
      }
      .msg {
        padding: 12px 14px;
        border-radius: 10px;
        margin: 8px 0;
        line-height: 1.4;
        white-space: pre-wrap;
        max-width: 85%;
      }
      .user {
        background: #1e293b;
        margin-left: auto;
        color: #e5e7eb;
      }
      .assistant {
        background: #0b3d2e;
        color: #e5e7eb;
      }
      .input-container {
        display: flex;
        gap: 8px;
        margin-top: 8px;
      }
      #userInput {
        flex: 1;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid #333;
        background: #000;
        color: #fff;
        min-height: 56px;
        resize: vertical;
        font-size: 1rem;
      }
      #sendBtn {
        padding: 10px 16px;
        border-radius: 10px;
        border: 1px solid #333;
        background: #333;
        color: #fff;
        cursor: pointer;
        font-size: 1rem;
      }
      #sendBtn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      #responseBox {
        background: #000;
        border: 1px solid #333;
        border-radius: 10px;
        padding: 16px;
        color: #e5e7eb;
        font-family: inherit;
        white-space: pre-wrap;
        max-width: 100%;
        min-height: 56px;
        overflow: auto;
      }
      .error {
        color: #fecaca;
        margin-top: 8px;
        font-size: 0.9rem;
      }
      a {
        color: #93c5fd;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>Ask questions about academic literacy</h1>
      <div class="chat-container">
        <div id="chat" class="chat" role="log" aria-live="polite"></div>
        <pre id="responseBox"></pre>
      </div>
      <div class="input-container">
        <input id="userInput" type="text" placeholder="Type a messageâ€¦" aria-label="Message" />
        <button id="sendBtn" type="button">Send</button>
      </div>
      <div id="err" class="error" aria-live="polite"></div>
    </div>

    <script>
      async function sendMessage(message) {
        const res = await fetch("/api/chat", {
          method: "POST",
          headers: { "content-type": "application/json" },
          body: JSON.stringify({ messages: [{ role: "user", content: message }] }),
        });
        const text = await res.text();
        if (!text) throw new Error(`Empty response: ${res.status}`);
        const data = JSON.parse(text);
        if (!res.ok) throw new Error(data.error || `HTTP ${res.status}`);
        return data;
      }

      document.getElementById("sendBtn").addEventListener("click", async () => {
        const msg = document.getElementById("userInput").value.trim();
        if (!msg) return;
        
        // Add user message to chat
        const chat = document.getElementById('chat');
        const userDiv = document.createElement('div');
        userDiv.className = 'msg user';
        userDiv.textContent = msg;
        chat.appendChild(userDiv);
        chat.scrollTop = chat.scrollHeight;
        
        // Clear input and show loading state
        document.getElementById("userInput").value = '';
        document.getElementById("responseBox").textContent = "Loading...";
        document.getElementById("sendBtn").disabled = true;
        document.getElementById("err").textContent = '';
        
        try {
          const data = await sendMessage(msg);
          const reply = data.choices?.[0]?.message?.content || JSON.stringify(data, null, 2);
          document.getElementById("responseBox").textContent = reply;
          
          // Also add assistant message to chat
          const assistantDiv = document.createElement('div');
          assistantDiv.className = 'msg assistant';
          assistantDiv.textContent = reply;
          chat.appendChild(assistantDiv);
          chat.scrollTop = chat.scrollHeight;
        } catch (err) {
          console.error(err);
          document.getElementById("responseBox").textContent = err.message;
          document.getElementById("err").textContent = err.message;
        } finally {
          document.getElementById("sendBtn").disabled = false;
        }
      });
    </script>
  </body>
</html>

